# RabbitMQ

## Terms
### Producer
Emits messages to exchange
### Consumer
Receives messages from the queue

### Queue
keeps/stores messages

### Exchange
- **Binding** connects an exchange with a queue using **binding key**
- Exchange compares **routing key** with a binding key (one-to-one or using pattern)


## Exchange
- Exchange type determines distribution model
- Exchange types:
	- nameless (empty string) - default one
	- fanout - 
	- direct
	- topic
	- headers
### Nameless exchange 
> (aka "default exchange", aka "AMQP default")
- Special one created by RabbitMQ
- Compares routing key with queue name
- Allows sending messages "directly" to the queue (form the publisher perspective exchange is transparent)

### Fanout
Simply routes a received message to all queues that are bound to it. Ignores routing key

### Direct
Routes a received message to the queue that matches "routing-key". Nameless exchange is a "direct" exchange

### Topic
Routes a received message to queues, where binding key (defined as a pattern) matches to the routing key. Example, binding-key: `*.logs.error`, routing key: `application1.logs.error`

### Headers
Same as topic, but binding key is compared against "any" or "all" message headers (header x-match determines the behavior)

## Queue
- **Located on single node where it was declared and referenced by unique name**. In contrary to Exchanges and Bindings which exist on all nodes. Nmae can be provided or auto-generated by RabbitMQ. Both: Producer and Consumer **can create a queue**.
- **Performance**
	- 1 queue - 1 Erlang process
	- When node start, up to **16384** messages are loaded into RAM from the queue.
- **Queue is ordered collection of messages**. Messages are published and consumed in the FIFO manner (except prioritized queues)
- **Queue has many properties** Depends from the use case we can set queue behavior
- **Queue can be federated or mirrored** to increase reliability and availability
- **Internal queues amq.** queues prefixed by `amq.` are used for RabbitMQ internal purposes only

## Queue properties

Among others RabbitMQ implements AMQP protocol. So, attributes (properties) and queue behavior can changed in many ways to support generic RabbitMQ architecture.
- **By common Queue definition**
	- Name, Durable, Auto-delete, Exclusive
	- `channel1.queueDeclare(QUEUE_NAME, true, false, false, ...)`
- **By protocol specific settings**
	- Priority
- **By  policy**

### Name
Name can be provided or auto generated

### Durable or not
Not durable queues won't survive broker restart

### Auto Delete feature
Queues deletes itself when all consumer disconnect

### Classic or Quorum
Quorum and Mirroring (policy) increases availability

### Exclusive
Used by only connection and the queue will be deleted when that connection closes

### Priority
Additional CPU cost and increased latency; no guarantee of exact order (just strong suggestion)

### Other Properties
Lazy Queues, Dead Letter Queues and many more


